(function(t){function e(e){for(var a,s,c=e[0],o=e[1],u=e[2],l=0,d=[];l<c.length;l++)s=c[l],r[s]&&d.push(r[s][0]),r[s]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);h&&h(e);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},s={app:0},r={app:0},i=[];function c(t){return o.p+"js/"+({}[t]||t)+"."+{"chunk-0aece4e7":"5d4c1df3","chunk-3741d0c4":"620a97e9","chunk-381930b4":"cafe3d0b","chunk-4f5aabde":"bc7b3e41","chunk-56aba622":"18cf56c2","chunk-69eb7cda":"441ca913","chunk-7b9182ec":"84b3b21f","chunk-a7d57dac":"8da624f0","chunk-a9ddebe0":"5e220d8d","chunk-b41f9798":"ad8bb6b5"}[t]+".js"}function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(t){var e=[],n={"chunk-0aece4e7":1,"chunk-3741d0c4":1,"chunk-381930b4":1,"chunk-4f5aabde":1,"chunk-56aba622":1,"chunk-69eb7cda":1,"chunk-7b9182ec":1,"chunk-a7d57dac":1,"chunk-a9ddebe0":1,"chunk-b41f9798":1};s[t]?e.push(s[t]):0!==s[t]&&n[t]&&e.push(s[t]=new Promise(function(e,n){for(var a="css/"+({}[t]||t)+"."+{"chunk-0aece4e7":"cdd4bc33","chunk-3741d0c4":"0a8554b3","chunk-381930b4":"691f4215","chunk-4f5aabde":"48769fba","chunk-56aba622":"862b789d","chunk-69eb7cda":"3af07f32","chunk-7b9182ec":"3e714399","chunk-a7d57dac":"3f60fc48","chunk-a9ddebe0":"b295e75b","chunk-b41f9798":"fa4a4517"}[t]+".css",s=o.p+a,r=document.getElementsByTagName("link"),i=0;i<r.length;i++){var c=r[i],u=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(u===a||u===s))return e()}var l=document.getElementsByTagName("style");for(i=0;i<l.length;i++){c=l[i],u=c.getAttribute("data-href");if(u===a||u===s)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var a=e&&e.target&&e.target.src||s,r=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");r.request=a,n(r)},d.href=s;var h=document.getElementsByTagName("head")[0];h.appendChild(d)}).then(function(){s[t]=0}));var a=r[t];if(0!==a)if(a)e.push(a[2]);else{var i=new Promise(function(e,n){a=r[t]=[e,n]});e.push(a[2]=i);var u,l=document.getElementsByTagName("head")[0],d=document.createElement("script");d.charset="utf-8",d.timeout=120,o.nc&&d.setAttribute("nonce",o.nc),d.src=c(t),u=function(e){d.onerror=d.onload=null,clearTimeout(h);var n=r[t];if(0!==n){if(n){var a=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src,i=new Error("Loading chunk "+t+" failed.\n("+a+": "+s+")");i.type=a,i.request=s,n[1](i)}r[t]=void 0}};var h=setTimeout(function(){u({type:"timeout",target:d})},12e4);d.onerror=d.onload=u,l.appendChild(d)}return Promise.all(e)},o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/express_site/",o.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=e,u=u.slice();for(var d=0;d<u.length;d++)e(u[d]);var h=l;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"06aa":function(t,e,n){},"10f9":function(t,e,n){"use strict";n.r(e),function(t){n("cadf"),n("551c"),n("097d");t.exports=[{id:1,email:"97167834@qq.com",password:null,name:"周佳俊",sex:"1",type:"2",profile:null,messages:[{id:1,to_id:2,from_id:1,text:"查杀",isread:"false",m_time:null},{id:2,to_id:2,from_id:1,text:"打底袜",isread:"false",m_time:null}]},{id:3,email:"553359973@qq.com",password:null,name:"无名",sex:"1",type:"2",profile:null,messages:[]}]}.call(this,n("dd40")(t))},"2e4c":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("header",{staticClass:"header"},[n("nav-header",{attrs:{rigtIcon:"&#xe613;"}})],1),n("div",{staticClass:"blank"}),n("main",{staticClass:"main"},[n("transition",{attrs:{mode:"out-in"}},[n("router-view")],1)],1),n("footer",{staticClass:"footer"},[n("WechatFooter",{directives:[{name:"show",rawName:"v-show",value:t.showFooter,expression:"showFooter"}]}),n("send-message-footer",{directives:[{name:"show",rawName:"v-show",value:t.showDialog,expression:"showDialog"}]})],1)])},r=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("footer",{staticClass:"footer"},[n("nav",{staticClass:"container"},[n("router-link",{staticClass:"nav-a",attrs:{to:"/chat"}},[n("div",{staticClass:"commit",on:{click:function(e){t.handleClick(0)}}},[n("i",{staticClass:"nav-a-i nav-a-icon iconfont"},[t._v(""),n("p",{staticClass:"messageCount"},[t._v(t._s(t.count))])]),n("i",{staticClass:"nav-a-i nav-a-text"},[t._v("chat")])])]),n("router-link",{staticClass:"nav-a",attrs:{to:"contacts"}},[n("div",{staticClass:"commit",on:{click:function(e){t.handleClick(1)}}},[n("i",{staticClass:"nav-a-i nav-a-icon iconfont"},[t._v("")]),n("i",{staticClass:"nav-a-i nav-a-text"},[t._v("Contacts")])])]),n("router-link",{staticClass:"nav-a",attrs:{to:"discover"}},[n("div",{staticClass:"commit",on:{click:function(e){t.handleClick(2)}}},[n("i",{staticClass:"nav-a-i nav-a-icon iconfont"},[t._v("")]),n("i",{staticClass:"nav-a-i nav-a-text"},[t._v("Discover")])])]),n("router-link",{staticClass:"nav-a",attrs:{to:"me"}},[n("div",{staticClass:"commit",on:{click:function(e){t.handleClick(3)}}},[n("i",{staticClass:"nav-a-i nav-a-icon iconfont"},[t._v("")]),n("i",{staticClass:"nav-a-i nav-a-text"},[t._v("Me")])])])],1)])},c=[],o=n("be94"),u=n("2f62"),l={name:"WechatFooter",data:function(){return{headerMenuArr:[{index:0,text:"Wechat"},{index:1,text:"Contacts"},{index:2,text:"Discover"},{index:3,text:"Me"}],count:0}},methods:Object(o["a"])({},Object(u["b"])({set_menu_msg:"SET_MENUMSG"}),{handleClick:function(t){this.set_menu_msg(this.headerMenuArr[t])}})},d=l,h=(n("d480"),n("2877")),f=Object(h["a"])(d,i,c,!1,null,"973aa200",null);f.options.__file="Footer.vue";var m=f.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"wechatHeader"}},[n("span",{staticClass:"header-list header-left header-icon"},["/chatting"===t.$route.path||"/contactdetail"===t.$route.path||"/addFriend"===t.$route.path?n("span",{staticClass:"header-icon",on:{click:t.back}},[t._v("")]):t._e()]),n("span",{staticClass:"header-list text-center"},[t._v(t._s(t.topBarMsg.text))]),"/chat"===t.$route.path?n("span",{staticClass:"header-list header-right header-icon",on:{click:function(e){t.$router.push("./addFriend")}}},[t._v("")]):t._e(),"/contacts"===t.$route.path?n("span",{staticClass:"header-list header-right header-icon",on:{click:function(e){t.$router.push("./addFriend")}}},[t._v("")]):t._e(),"/chatting"===t.$route.path?n("span",{staticClass:"header-list header-right header-icon"},[t._v("")]):t._e()])},v=[],g=(n("6b54"),n("7f43")),b=n.n(g),_={name:"WechatHeader",computed:{topBarMsg:function(){return this.$store.state.topBarMsg}},methods:{back:function(){this.$router.back(),b.a.post("/express_site/hasread.action",{id:this.$store.getters.getCurrentUserId}),this.$store.commit("SET_MENUMSG",{index:0,text:"Wechat"})}},filters:{capitalize:function(t){return t?(t=t.toString(),t.charAt(0).toUpperCase()+t.slice(1)):""}}},C=_,k=(n("e684"),Object(h["a"])(C,p,v,!1,null,"77f41470",null));k.options.__file="Header.vue";var x=k.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"outer"},[n("i",{staticClass:"line-top"}),n("div",{staticClass:"container"},[n("span",{staticClass:"voice iconfont"},[t._v("")]),n("div",{staticClass:"input"},[n("input",{attrs:{type:"text",name:"sendMsg"},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.send()}}})]),n("span",{staticClass:"expressions iconfont"},[t._v("")]),n("span",{staticClass:"add iconfont"},[t._v("")])])])},y=[],$={name:"SendMessage",methods:{send:function(){var t=document.getElementsByTagName("input")[0].value;if(""!==t.trim()){document.getElementsByTagName("input")[0].value="";var e={id:null,to_id:this.$store.getters.getTmpContact.id,from_id:this.$store.getters.getCurrentUserId,text:t,isread:"n",m_time:(new Date).getTime()};this.$store.commit("addMsg",e),this.$store.dispatch("wsSend",JSON.stringify(e))}else this.$notify.error({title:"输入非法",message:"内容不能为空"})}}},E=$,S=(n("a26a"),Object(h["a"])(E,w,y,!1,null,"536275ab",null));S.options.__file="SendMessage.vue";var T=S.exports,M={name:"App",data:function(){return{iconRight:function(){return this.$route.meta.iconRight},showFooter:!0,showDialog:!1}},components:{WechatFooter:m,"nav-header":x,"send-message-footer":T},watch:{$route:function(t){"/chatting"===t.path?(this.showFooter=!1,this.showDialog=!0):"/signin"===t.path||"/signup"===t.path||"/addFriend"===t.path?this.showFooter=this.showDialog=!1:(this.showFooter=!0,this.showDialog=!1)}},created:function(){var t=n("10f9");this.$store.commit("setFriends",t)}},O=M,j=(n("7c55"),Object(h["a"])(O,s,r,!1,null,null,null));j.options.__file="App.vue";var F=j.exports,N=n("8c4f"),U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"chats"}},[n("Search"),t._l(t.chatItems.length,function(e){return n("ChatItem",{attrs:{chat:t.chatItems[e-1]}})})],2)},A=[],I=(n("7f7f"),n("ac6a"),n("944c")),P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"chat-item",on:{click:t.handleClick}},[n("section",{staticClass:"chat-item-sec chat-item-left"},[n("img",{staticClass:"chat-item-profile",attrs:{src:"profile/"+t.chat.profile,alt:"alex"}}),t.messageCount>0?n("p",{staticClass:"messageCount"},[t._v(t._s(t.messageCount))]):t._e()]),n("section",{staticClass:"chat-item-sec chat-item-right"},[n("b",{staticClass:"title"},[t._v(t._s(t.chat.name))]),n("b",{staticClass:"message"},[t._v(t._s(t._f("textOverflow")(t.endText)))])]),n("section",{staticClass:"time"},[t._v("4:50 PM")])]),n("i",{staticClass:"line clearfix"})])},B=[],D={name:"ChatItem",data:function(){return{endText:""}},computed:{messageCount:function(){return this.$store.getters.getUnreadCount(this.chat.id).length}},props:{chat:{type:Object}},methods:{handleClick:function(){b.a.post("/express_site/hasread.action",{id:this.$store.getters.getCurrentUserId}),this.$store.commit("SET_TMP_CONTACT",this.chat);var t="",e=this.$store.getters.getTmpContact.name;e===this.chat.name&&(t=e),this.$store.commit("SET_MENUMSG",{index:-1,text:t}),this.$router.push({name:"chatting",params:{userid:this.chat.id}})}},filters:{textOverflow:function(t){return t.length>25?t.slice(0,25)+"...":t}},mounted:function(){var t=this,e=this.$store.getters.getFriends;e.forEach(function(e){if(t.chat.id===e.id){var n=e.messages;t.endText=n.last().text}})}},W=D,q=(n("c5f5"),Object(h["a"])(W,P,B,!1,null,"2f39383d",null));q.options.__file="ChatItem.vue";var G=q.exports,J={name:"Chats",components:{Search:I["a"],ChatItem:G},data:function(){return{chatItems:[]}},mounted:function(){var t=this,e=this.$store.getters.getFriends;e.forEach(function(e){e.messages.length>0&&t.chatItems.push({name:e.name,profile:e.profile,id:e.id})})}},H=J,L=(n("9128"),Object(h["a"])(H,U,A,!1,null,"069c743c",null));L.options.__file="Chats.vue";var R=L.exports,z=[{path:"/",redirect:"/signin"},{path:"/chat",name:"Chats",component:R},{path:"/contacts",name:"contacts",component:function(){return n.e("chunk-7b9182ec").then(n.bind(null,"c93c"))}},{path:"/discover",name:"discover",component:function(){return n.e("chunk-a7d57dac").then(n.bind(null,"6723"))}},{path:"/me",name:"me",component:function(){return n.e("chunk-a9ddebe0").then(n.bind(null,"0a99"))}},{path:"/chatting",name:"chatting",component:function(){return n.e("chunk-4f5aabde").then(n.bind(null,"ab11"))}},{path:"/signup",name:"signup",component:function(){return n.e("chunk-69eb7cda").then(n.bind(null,"5c9c"))}},{path:"/signin",name:"signin",component:function(){return n.e("chunk-3741d0c4").then(n.bind(null,"54e2"))}},{path:"/contactdetail",name:"contactdetail",component:function(){return n.e("chunk-381930b4").then(n.bind(null,"90fa"))}},{path:"/addFriend",name:"addFriend",component:function(){return n.e("chunk-56aba622").then(n.bind(null,"1a50"))}},{path:"/searchedContact",name:"searchedContact",component:function(){return n.e("chunk-0aece4e7").then(n.bind(null,"8558"))}},{path:"/test",name:"test",component:function(){return n.e("chunk-b41f9798").then(n.bind(null,"2762"))}}];a["default"].use(N["a"]);var K=new N["a"]({routes:z});K.beforeEach(function(t,e,n){var a=["/chat","/contacts","/discover","/me"];a.some(function(e){return e===t.path});n()});var Q,V=K,X={topBarMsg:{index:0,text:"Wechat"},tmpContact:{},searchedUser:{},ws:{},test:"",rev_msg:{}},Y=n("ade3"),Z="SET_TMP_CONTACT",tt=(Q={SET_MENUMSG:function(t,e){t.topBarMsg=e}},Object(Y["a"])(Q,Z,function(t,e){t.tmpContact=e}),Object(Y["a"])(Q,"set_test",function(t,e){t.test=e}),Object(Y["a"])(Q,"addrevmsg",function(t,e){t.rev_msg=e}),Q),et={wsOpen:function(t){var e=t.state,n=t.commit;e.ws=new WebSocket("ws://47.96.72.48/express_site/websocket.action"),e.ws.onmessage=function(t){var e=JSON.parse(t.data);console.log(e),console.log("evt.data"),console.log(t.data),e.sex&&n("addFriend",e),e.from_id&&n("addrevmsg",e)},e.ws.onerror=function(t){console.log("evt",t),console.log("WebSocketError!")}},wsSend:function(t,e){var n=t.state;n.ws.send(e)},wsClose:function(t){var e=t.state;console.log("closing websocket"),e.ws.close()}},nt={getTmpContact:function(t){return t.tmpContact},get_test:function(t){return function(e){return t.test.filter(function(t){return t.id===e})}},get_rev_msg:function(t){return t.rev_msg}},at={user:{}},st={getCurrentUserId:function(t){return t.user.id},getCurrentUser:function(t){return t.user}},rt={setUser:function(t,e){t.user=e}},it={state:at,getters:st,mutations:rt},ct=it,ot={friends:[]},ut={setFriends:function(t,e){t.friends=e},addMsg:function(t,e){var n=!1;return t.friends.forEach(function(t){t.id!==e.to_id&&t.id!==e.from_id||t.messages.push(e),n=!0}),n},addFriend:function(t,e){t.friends.push(e)}},lt={getFriends:function(t){return t.friends},getUnreadCount:function(t){return function(e){return t.friends.filter(function(t){return t.id===e})[0].messages.filter(function(t){return"n"===t.isread})}}},dt={state:ot,mutations:ut,getters:lt},ht=dt;a["default"].use(u["a"]);var ft=new u["a"].Store({state:X,mutations:tt,actions:et,getters:nt,modules:{user:ct,friends:ht}}),mt=n("88da"),pt=n.n(mt);n("e382"),n("ad06"),n("d3e7");a["default"].config.productionTip=!1,a["default"].use(pt.a),new a["default"]({router:V,store:ft,render:function(t){return t(F)}}).$mount("#app"),Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]})},"5c48":function(t,e,n){},"5f93":function(t,e,n){"use strict";var a=n("f0bb"),s=n.n(a);s.a},"7c55":function(t,e,n){"use strict";var a=n("5c48"),s=n.n(a);s.a},9128:function(t,e,n){"use strict";var a=n("06aa"),s=n.n(a);s.a},"944c":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"search clearfix"},[n("div",{staticClass:"srh-div iconfont",attrs:{type:"text"}},[t._v("\n     Search\n  ")])])}],r={name:"Search"},i=r,c=(n("5f93"),n("2877")),o=Object(c["a"])(i,a,s,!1,null,"67f06a36",null);o.options.__file="Search.vue";e["a"]=o.exports},a26a:function(t,e,n){"use strict";var a=n("d772"),s=n.n(a);s.a},ad89:function(t,e,n){},b570:function(t,e,n){},c5f5:function(t,e,n){"use strict";var a=n("b570"),s=n.n(a);s.a},d3e7:function(t,e,n){},d480:function(t,e,n){"use strict";var a=n("2e4c"),s=n.n(a);s.a},d772:function(t,e,n){},e382:function(t,e,n){},e684:function(t,e,n){"use strict";var a=n("ad89"),s=n.n(a);s.a},f0bb:function(t,e,n){}});